<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AI Code Generator</title>

<!-- Font -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">

<!-- Highlight.js -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>

<style>
:root{
  --bg:#020617;
  --card:#0b1220;
  --border:#1f2937;
  --blue:#2563eb;
  --green:#22c55e;
  --red:#ef4444;
  --text-muted:#9ca3af;
}

body{
  background:radial-gradient(circle at top,#020617,#000);
  color:white;
  font-family:'Inter',Arial;
  margin:0;
}

.container{
  max-width:900px;
  margin:auto;
  padding:18px;
}

header{
  text-align:center;
  margin-bottom:16px;
}
header h1{
  margin:0;
}
header p{
  color:var(--text-muted);
  margin-top:6px;
}

.controls{
  display:flex;
  gap:10px;
  flex-wrap:wrap;
  justify-content:center;
  margin-bottom:12px;
}

.controls button{
  background:var(--card);
  color:white;
  border:1px solid var(--border);
  padding:8px 14px;
  border-radius:8px;
  cursor:pointer;
}

.controls button.active{
  background:var(--blue);
}

.clear-btn{
  background:var(--red);
  border:none;
}

.chat{
  margin-top:12px;
}

.user{
  color:#4ade80;
  margin:10px 0;
}

.bot{
  background:var(--card);
  padding:14px;
  border-radius:14px;
  margin-bottom:14px;
  animation:fade .25s ease-in-out;
}

.bot p{
  margin-top:0;
}

textarea{
  width:100%;
  height:80px;
  background:#000;
  color:white;
  border:1px solid var(--border);
  padding:12px;
  border-radius:12px;
  resize:none;
}

button.send{
  width:100%;
  margin-top:10px;
  padding:12px;
  background:var(--green);
  border:none;
  color:black;
  font-size:16px;
  border-radius:12px;
}

pre{
  overflow-x:auto;
  margin:0;
}

@media(max-width:600px){
  textarea{height:70px;}
}

@keyframes fade{
  from{opacity:0; transform:translateY(6px);}
  to{opacity:1; transform:translateY(0);}
}
</style>
</head>

<body>
<div class="container">

<header>
  <h1>ğŸ¤– AI Code Generator</h1>
  <p>Ø£Ù†Ø´Ø¦ ÙƒÙˆØ¯ Ù†Ø¸ÙŠÙ ÙˆØ§Ø­ØªØ±Ø§ÙÙŠ Ø®Ù„Ø§Ù„ Ø«ÙˆØ§Ù†ÙŠ</p>
</header>

<div class="controls">
  <button id="modeCode" class="active" onclick="setMode('code')">ğŸ’» ÙƒÙˆØ¯ ÙÙ‚Ø·</button>
  <button id="modeExplain" onclick="setMode('full')">ğŸ§  Ø´Ø±Ø­ + ÙƒÙˆØ¯</button>
  <button class="clear-btn" onclick="clearChat()">ğŸ—‘ï¸ Ù…Ø³Ø­</button>
</div>

<div id="chat" class="chat"></div>

<textarea id="input" placeholder="Ø§ÙƒØªØ¨ Ø·Ù„Ø¨Ùƒ Ù‡Ù†Ø§..."></textarea>
<button class="send" onclick="send()">Ø¥Ø±Ø³Ø§Ù„</button>

</div>

<script>
const BACKEND = "https://ai-genreting-code.up.railway.app/chat";
const STORAGE_KEY = "ai_code_history";
let mode = "code";

/* ---------- MODE ---------- */
function setMode(m){
  mode = m;
  document.getElementById("modeCode").classList.toggle("active", m==="code");
  document.getElementById("modeExplain").classList.toggle("active", m==="full");
}

/* ---------- TYPEWRITER ---------- */
function typeText(el, text, i=0){
  if(i < text.length){
    el.textContent += text.charAt(i);
    setTimeout(()=>typeText(el,text,i+1), 6);
  }
}

/* ---------- RESPONSE SPLIT ---------- */
function splitResponse(text){
  const match = text.match(/```[\s\S]*?```/);
  return {
    explanation: text.replace(/```[\s\S]*?```/, "").trim(),
    code: match ? match[0].replace(/```/g,"") : text
  };
}

/* ---------- LOCAL STORAGE ---------- */
function saveHistory(html){
  let history = JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]");
  history.push(html);
  history = history.slice(-5); // Ø¢Ø®Ø± 5 ÙÙ‚Ø·
  localStorage.setItem(STORAGE_KEY, JSON.stringify(history));
}

function loadHistory(){
  const chat = document.getElementById("chat");
  const history = JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]");
  history.forEach(h => chat.insertAdjacentHTML("beforeend", h));
}

function clearChat(){
  document.getElementById("chat").innerHTML = "";
  localStorage.removeItem(STORAGE_KEY);
}

/* ---------- SEND ---------- */
async function send(){
  const input = document.getElementById("input");
  const chat = document.getElementById("chat");
  const message = input.value.trim();
  if(!message) return;

  chat.innerHTML += `<div class="user">ğŸ§‘â€ğŸ’» ${message}</div>`;
  input.value = "";

  const res = await fetch(BACKEND,{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({message})
  });

  const data = await res.json();
  const parts = splitResponse(data.reply);
  const id = "c"+Date.now();

  let html = `<div class="bot">`;
  if(mode==="full"){
    html += `<p>${parts.explanation}</p>`;
  }
  html += `<pre><code id="${id}" class="language-python"></code></pre></div>`;

  chat.insertAdjacentHTML("beforeend", html);

  const codeEl = document.getElementById(id);
  typeText(codeEl, parts.code);
  hljs.highlightAll();

  saveHistory(html);
}

/* ---------- INIT ---------- */
loadHistory();
</script>

</body>
</html>
